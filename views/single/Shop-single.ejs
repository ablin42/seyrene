<% include ../partials/head %>

<script src="/scripts/cart.js"></script>
<div class="container container-single">
	<div class="single-wrapper">
		<% if (locals.shop){ %>
		<div class="col-10 offset-1" id="<%= locals.shop._id %>">
			<h3 class="single-title col-12">
				<%= locals.shop.title %> <% if (locals.user && locals.user.role === "admin") { %>
				<a href="/Admin/Shop/Patch/<%= locals.shop._id %>"><i class="fas fa-edit"></i></a>
				<% } %>
			</h3>

			<div class="carousel-container mt-3">
				<div id="carousel-thumb" class="carousel slide carousel-fade carousel-thumbnails" data-ride="carousel">
					<div class="carousel-inner" role="listbox">
						<% if (locals.img) { %> <% locals.img.forEach(function (item, index) { %>
						<div class="carousel-item <% if(index == 0) { %>active<% } %>">
							<a href="#expand"><img onclick="expand(this);" src="/api/image/<%= item._id %>" alt="<%= index %>slide" /></a>
							<div class="carousel-caption d-none d-md-block"></div>
						</div>
						<% }) %> <% } %>
					</div>
					<!--Controls-->
					<a class="carousel-control-prev" href="#carousel-thumb" role="button" data-slide="prev">
						<span><i class="fas fa-chevron-left fa-4x"></i></span>
						<span class="sr-only">Previous</span>
					</a>
					<a class="carousel-control-next" href="#carousel-thumb" role="button" data-slide="next">
						<span><i class="fas fa-chevron-right fa-4x"></i></span>
						<span class="sr-only">Next</span>
					</a>
					<!--/.Controls-->
				</div>
			</div>
			<div class="thumbnail-wrapper mb-4 mt-3">
				<ol class="carousel-indicators no-thumb">
					<% if (locals.img) { %> <% locals.img.forEach(function (item, index) { %>
					<li data-target="#carousel-thumb" data-slide-to="<%= index %>" class="<% if(index == 0) { %>active<% } %>">
						<img class="d-block w-100" src="/img/white_circle.png" alt="..." class="img-fluid" />
					</li>
					<% }) %> <% } %>
				</ol>
			</div>

			<p class="blog-content col-10 offset-1 mt-2"><%= locals.shop.content %></p>

			<div class="col-10 offset-1 text-center">
				<b class="card-price"><%= locals.shop.price %>â‚¬</b>
				<b class="isUnique" style="color: var(--light-shade);">Toile unique</b>
				<input type="submit" class="logbtn" value="Add to cart" onclick="cartAdd('<%= locals.shop._id %>', this)" /><!--disabled -->
			</div>
			<% } %>
		</div>
	</div>
</div>

<a class="lightbox-close" href="#close">
	<div class="lightbox-target" id="expand">
		<img id="expandImg" src="/api/image/<%= locals.img[0]._id %>" />
	</div>
</a>

<script>
	$("#carousel-thumb").on("slide.bs.carousel", function (element) {
		$("div.thumbnail-wrapper.mb-3 > ol > li.active").removeClass("active");
		$(`div.thumbnail-wrapper.mb-3 > ol > li:nth-child(${element.to + 1})`).addClass("active");
	});
</script>
<script src="/scripts/frontValidation.js"></script>
<% include ../partials/footer %>
