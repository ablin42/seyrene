<% include ../partials/head %>

<div class="container">
    <div class="form-container gallery-form">
        <form id="shop" method="POST" action="/api/shop/patch/<%= locals.shop._id %>" enctype="multipart/form-data" onsubmit="patchShop(event);"> 
            <h1 class="form-title">Editer un item de la boutique</h1>
            <div class="txtb">
                <input type="text" name="title" id="title" value="<%= locals.shop.title %>" onkeyup="Validate.String(this, 1, 256);" required>
                <span data-placeholder="Title"></span>
                <span id="i_title" class="form-info">Title must contain between 1 and 256 characters</span>
            </div>
            
            <textarea id="content" name="content" class="blog-textarea" placeholder="Your item description here" onkeyup="Validate.String(this, 1, 2048);" required><%= locals.shop.content %></textarea>
            <span id="i_content" class="form-info">Content must contain between 1 and 2048 characters</span>

            <div class="form-group">
                <img src="/api/shop/image/<%= locals.shop._id %>"/>
                <input type="file" name="img" id="img">
            </div>
            
            <div class="form-group">
                <label>price</label>
                <input type="number" id="price" name="price">
            </div>
            <div class="form-group">
                <label>check if this is an unique item</label>
                <input type="checkbox" name="isUnique" id="isUnique">
            </div>
        
            <input type="submit" class="logbtn" value="Update" id="submit-shop">
        </form>
    <hr />
    <form method="GET" action="/api/shop/delete/<%= locals.shop._id %>">
        <input type="submit" class="delbtn" value="DELETE" id="delete-blog">
    </form>
</div>

<script>
    async function patchShop(e) {
        e.preventDefault();
        let title = $("#title").val(),
            content = $("#content").val(),
            img = document.querySelector('#img'),
            formData = new FormData();
            
        formData.append('img', img.files[0]);
        formData.append('title', title);
        formData.append('content', content);
            
        fetch('/api/shop/patch/<%= locals.shop._id %>', {
            method: 'post',
            mode: 'same-origin',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
        if (data.err) {
            let alert = `
            <div id="alert" class="alert alert-warning" role="alert">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
                ${data.msg}
            </div>`;
            addAlert(alert, "#header")
        } else 
            window.location.href = data.url                
        })
    }
</script>
    <script src="/scripts/frontValidation.js"></script>
    <script src="/scripts/formFocus.js"></script>
</div>
  
<% include ../partials/footer %>