<% include partials/head %>

<script src="/scripts/gallery/infiniteTags.js"></script>
<script src="/scripts/bootstrap-tagsinput.js"></script>
<script src="/scripts/cart.js"></script>
<div class="container">
    <div class="container-gallery" id="container-gallery">
        
        <form id="tags" method="GET" action="/Galerie/tags" onsubmit="filterByTags(event)"> 
            <div class="form-group">
                <label>filter by tags</label>
                <input v-bind="selectedTags" type="text" value="" data-role="tagsinput" id="tagInput" class="form-control">
                <span data-placeholder="Tags"></span>
            </div>

            <input type="submit" class="logbtn" value="Filter" id="submit-tags">
        </form>

          <% if(locals.galleries){ %>
            <% Object.keys(locals.galleries).forEach(function (index) { %>
              <div class="card" id="<%= locals.galleries[index]._id %>">
                <a href="#expand"><img onclick="expand(this);" src="/api/image/<%= locals.galleries[index].mainImgId %>" class="card-img-top" alt="<%= locals.galleries[index].title %>"></a>
                <div class="card-body">
                  <h5 class="card-title"><i><a href="Galerie/<%= locals.galleries[index]._id %>"><%= locals.galleries[index].title %></a></i></h5>
                  <p class="card-text gallery-description"><%= locals.galleries[index].content %></p>
                  <p class="card-text">
                    <% locals.galleries[index].tags.forEach(function (tag) { %>
                        <a href="/Galerie/Tags?t=<%= tag %>">#<%= tag %></a>
                    <% }) %>
                  </p>
                </div>
              </div>
            <% }) %>
          <% } %>
    </div>
    <div class="col-6 offset-3 mb-3 mt-3">
      <img id="loader" src="/img/loader.gif" style="width: 50px; height: 50px; margin: 5px auto 5px auto; display: none">
      <input type="submit" class="logbtn" value="Load more" onclick="infiniteTags();">
    </div>
</div>

<script>
    let tagInput = $("#tagInput");
    let tags = "<%= locals.tags %>";
    tags = tags.split(',')

    tagInput.tagsinput('add', "");
    for (i = 0; i < tags.length; i++)
        tagInput.tagsinput('add', tags[i]);
</script>

<script src="/scripts/gallery/galleryScripts.js"></script>
<a class="lightbox-close" href="#close">
    <div class="lightbox-target" id="expand">
        <% if(locals.galleries){ %>
            <img id="expandImg" src="/api/image/<%= locals.galleries[0].mainImgId %>"/>
        <% } %>
    </div>
</a>

<% include partials/footer %>